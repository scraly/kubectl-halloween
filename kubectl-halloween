#!/bin/bash

##########################################################################
# kubectl-halloween                                                      #
#                                                                        #
# Welcome in Halloween plugin for kubectl Kubernetes CLI                 #
# which display randomly an emoji in the beginning of the resources name #
#                                                                        #
# USAGE:                                                                 #
# ./kubectl-halloween get <resource_type>                                #
##########################################################################

# Select emoji randomly
EMOJIS=(ðŸŽƒ ðŸ‘» ðŸ§Ÿ ðŸ§› ðŸ•· ðŸ§™ ðŸ’€ â˜  ðŸ˜ˆ)
SELECTED_EMOJI=${EMOJIS[$(( ( RANDOM % ${#EMOJIS[@]} ) ))]};

# Usage
if [[ "$1" == "" || "$1" == "-h" || "$1" == "--help" ]]
then
    n=$'\n'
    usage="Display Halloween emoji randomly just before resources name.${n}${n}Usage:${n}   kubectl halloween get <resource_type>"

    echo "$usage" 
    exit 1
fi

# Main
if [[ "$1" == "get" ]]
then
    # add an emoji at the beginning of the line except for blank line and line beginning by NAME
    kubectl "$@" | sed -E "/^(NAME|$)/ ! s/^/${SELECTED_EMOJI} /"
else
    kubectl "$@"
fi

#TODO: 
# afficher des emojis differents selon le type de ressource en random